Component({lifetimes:{detached:function(){this.clearSto()}},detached:function(){this.clearSto()},properties:{sidkey:{type:String,value:""},screenwidth:{type:Number,value:320},paddingwidth:{type:Number,value:50},placeholderValue:{type:String,value:"请输入验证码"},baseurl:{type:String,value:""},options:{type:Object,value:""},imgUn:{type:String,value:""}},data:{disabledValue:false,checkState:-1,hidden:"",focus:false,capValue:"",imgurl:""},methods:{clearSto:function(){if(this.sto){clearTimeout(this.sto)}},onclear:function(){this.setData({capValue:""});this.doFocus()},onCapInput:function(e){this.setData({capValue:e.detail.value});if(this.data.capValue.length===4){this.doCheckCap()}},doCheckCap:function(){this.setData({disabledValue:true});this.triggerEvent("capCheck",{val:this.data.capValue},{})},onStateSuccess:function(){this.setData({checkState:1});this.sto=setTimeout(function(){this.setData({hidden:"hidden"});this.triggerEvent("capSuccess",{val:this.data.capValue},{})}.bind(this),500)},onStateFail:function(){this.setData({checkState:0});this.sto=setTimeout(function(){this.setData({capValue:"",checkState:-1,disabledValue:false,focus:true});this.onRefresh()}.bind(this),300)},onRefresh:function(){this.triggerEvent("getUn");let query="pd="+this.data.pd+"&pkid="+this.data.pkid+"&pkht="+this.data.pkht+"&channel="+this.data.channel+"&un="+encodeURIComponent(this.data.imgUn)+"&id="+wx.getStorageSync(this.data.sidkey)+"&nocache="+(new Date).getTime();if(!this.data.disabledValue){this.setData({imgurl:this.data.baseurl+query})}},onClose:function(){this.triggerEvent("close",{show:false,isimg:true},{})}},ready:function(){let options=this.data.options;Object.keys(options).forEach(function(key){if(key!="buttonBgColor"&&key!="buttonColor"){let tempObj={};tempObj[key]=options[key];this.setData(tempObj)}}.bind(this));this.onRefresh()}});