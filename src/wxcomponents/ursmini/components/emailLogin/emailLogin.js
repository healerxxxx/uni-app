const util=require("../util/util").util;var pageBase=require("../base/pageBase");const PREFIX="l_s_";const REGMAP={email:/^[\w-\.]+@(?:[\w-]+\.)+[a-z]{2,6}$/i,password:/.*/};const CHECKFORMLIST=["email","password"];const ERRORMAP={email:{empty:"请输入帐号",invalid:"请输入正确的帐号"},password:{empty:"请输入密码"}};const URLMAP={4:"/dl/wx/mail/vftcp",5:"/dl/wx/mail/vfccp",6:"/dl/wx/mail/vfscp"};Component({behaviors:[pageBase],properties:{},data:{ulogo:"https://webzj.netstatic.net/webzj_weixin/wxmaillogo.png",email:"",password:"",channel:100,imgBaseUrl:"/dl/wx/mail/cp?",imgUn:"",loginbtntxt:"登录"},lifetimes:{detached:function(){this.clearSto()}},detached:function(){this.clearSto()},ready:function(){this.formatOptions(PREFIX);if(this.data.preMail){this.selectComponent("#email").setMail(this.data.preMail)}this.CHECKFORMLIST=CHECKFORMLIST;this.ERRORMAP=ERRORMAP;this.REGMAP=REGMAP;let data={pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel};let id=wx.getStorageSync(this.data.sidkey);if(id){data.id=id}util.setBtnTxt(this.data.loginbtntxt,"email");util.clearFail5("email");this.requestProxy({isInit:1,url:"/dl/wx/mail/ini",data:data,success:this.initSuccess.bind(this),fail:this.initFail.bind(this)})},methods:{onGetUn:function(){let comp=this.selectComponent("#email");this.setData({imgUn:comp.getValue()})},onTap:function(e){},getVfData:function(data){data.un=this.data.email;return data},getVfUrl:function(){let capFlag=this.data.capFlag;let url=URLMAP[capFlag]||"/dl/wx/mail/vfcp";return url},gtSuccess:function(res){this.requestProxy({url:"/dl/wx/mail/l",method:"POST",data:{pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel,id:wx.getStorageSync(this.data.sidkey),un:this.data.email,pw:util.encrypt2(this.data.password),tk:res.tk},success:this.loginSuccess.bind(this),fail:this.loginFail.bind(this)})},gtFail:function(res){this.showError(res)},doLogin:function(){if(!this.checkInitOk()){return}this.setData({capValue:""});this.requestProxy({url:"/dl/wx/mail/gt",method:"GET",data:{pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel,id:wx.getStorageSync(this.data.sidkey),un:this.data.email},success:this.gtSuccess.bind(this),fail:this.gtFail.bind(this)})}}});