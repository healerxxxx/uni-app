require("./../../runtime"),require("./../../common"),(wx.webpackJsonp=wx.webpackJsonp||[]).push([[2],{20:function(t,e,a){"use strict";var r=p(a(1)),i=a(0),n=a(2),s=p(n),u=p(a(10)),c=p(a(6)),o=p(a(11)),f=a(4),h=a(3),d=p(a(5));function p(t){return t&&t.__esModule?t:{default:t}}function v(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function r(i,n){try{var s=e[i](n),u=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var l,y;Component({behaviors:[d.default],data:{beginTime:0,isReady:!1,verifyStatus:""},attached:function(){this.initData(),this.triggerEvent("init"),this.reset()},methods:{initData:function(){var t=this.store.state,e=t.config,a=t.$fetch;if(!e)throw new s.default(n.CONFIG_ERROR,"[core] config must not be null");this.$fetch=a},fetchCaptcha:(y=v(r.default.mark(function t(){var e,a,o,f,h,d,p,v;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.store.state,a=e.config,o=e.drp,f={id:a.captchaId,https:!0,type:a.captchaType,version:"1.0.0",drp:o,dev:i.DEVICE_TYPE.TOUCH,cb:(0,u.default)(),width:240,runEnv:i.RUNENV},h="/api/v2/mp/get",this.setData({verifyStatus:"loading"}),t.prev=4,t.next=7,this.$fetch({url:h,data:f,onTryError:(0,c.default)(a)});case 7:d=t.sent,p=d.data,this.store.commit("UPDATE_TOKEN",{token:p.token}),this.store.commit("UPDATE_TYPE",{captchaType:p.type}),this.setData({verifyStatus:"loaded"}),this.data.isReady||(this.triggerEvent("ready"),this.setData({isReady:!0})),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(4),this.setData({verifyStatus:"loadFailed"}),v=new s.default(n.REQUEST_API_ERROR,t.t0.message,{url:h}),this.triggerEvent("error",v);case 20:case"end":return t.stop()}},t,this,[[4,15]])})),function(){return y.apply(this,arguments)}),verifyCaptcha:(l=v(r.default.mark(function t(){var e,a,d,p,v,l,y,E,g,m,w,R,S=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.data.verifyStatus||"loaded"===this.data.verifyStatus){t.next=2;break}return t.abrupt("return");case 2:return e=this.store.state,a=e.config,d=e.captchaType,p=e.token,v=[],l=(0,f.xor_encode)(p,[0,0,Date.now()-this.data.beginTime]+""),y={id:a.captchaId,token:p,type:d||"",version:"1.0.0",cb:(0,u.default)(),runEnv:i.RUNENV,width:240,data:JSON.stringify({d:"",m:(0,f.eypt)((0,h.sample)(v,i.SAMPLE_NUM).join(":")),p:(0,f.eypt)(l),ext:(0,f.eypt)((0,f.xor_encode)(p,"1,"+v.length))})},E="/api/v2/mp/check",g=function(t){var e=void 0;e=t?new s.default(n.REQUEST_API_ERROR,t.message,{url:E,token:p}):new s.default(n.BUSINESS_ERROR,"Failed to verify captcha.",{url:E}),S.setData({verifyStatus:"failed"}),S.triggerEvent("verify",[e])},this.setData({verifyStatus:"verifying"}),t.prev=9,t.next=12,this.$fetch({url:E,method:"POST",data:y,onTryError:(0,c.default)(a,{token:p})});case 12:m=t.sent,(w=m.data).result?(R=(0,o.default)((0,f.eypt)(w.validate+"::")),this.setData({verifyStatus:"success"}),this.triggerEvent("verify",[null,R])):g(),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(9),g(t.t0);case 20:case"end":return t.stop()}},t,this,[[9,17]])})),function(){return l.apply(this,arguments)}),reset:function(){this.setData({beginTime:Date.now(),verifyStatus:""}),this.fetchCaptcha()}}})}},[[20,1,0]]]);