const util=require("../util/util").util;var pageBase=require("../base/pageBase");const mbreg=/^86-(13|14|15|16|17|18|19)\d{9}$/;var REGMAP={mobile:mbreg,password:/.*/};var ERRORMAP={mobile:{empty:"请输入手机号码",invalid:"手机号格式错误",invalid2:"手机号码格式错误，请更换后重试",invalid11:"请输入11位手机号码"},password:{empty:"请输入密码"}};const URLMAP={4:"/dl/wx/yd/vftcp",5:"/dl/wx/yd/vfccp",6:"/dl/wx/yd/vfscp"};const PREFIX="l_yd_s_";const CHECKFORMLIST=["mobile","password"];Component({behaviors:[pageBase],properties:{saveTempMobile:{type:String,value:""},saveTempMobileNm:{type:String,value:""}},data:{changeColor:"",mobile:"",password:"",channel:101,imgBaseUrl:"/dl/wx/yd/cp?",imgUn:"",loginbtntxt:"登录"},lifetimes:{detached:function(){this.clearSto()}},detached:function(){this.clearSto()},methods:{onGetUn:function(){let comp=this.selectComponent("#mobile");this.setData({imgUn:comp.getValue()})},onAreaChange:function(e){if(e.detail.area!="86"){this.REGMAP.mobile=/^\d{3,19}$/}else{this.REGMAP.mobile=mbreg}},getVfData:function(data){data.un=this.getMobileValue();return data},getVfUrl:function(){let capFlag=this.data.capFlag;let url=URLMAP[capFlag]||"/dl/wx/yd/vfcp";return url},gtSuccess:function(res){this.requestProxy({url:"/dl/wx/yd/lpwd",method:"POST",data:{pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel,id:wx.getStorageSync(this.data.sidkey),un:this.getMobileValue(),pw:util.encrypt2(this.data.password),tk:res.tk},success:this.loginSuccess.bind(this),fail:this.loginFail.bind(this)})},gtFail:function(res){this.showError(res)},doLogin:function(){if(!this.checkInitOk()){return}this.setData({capValue:""});this.requestProxy({url:"/dl/wx/yd/gt",method:"GET",data:{pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel,id:wx.getStorageSync(this.data.sidkey),un:this.getMobileValue()},success:this.gtSuccess.bind(this),fail:this.gtFail.bind(this)})},onRedirectTo:function(){let mobile=this.selectComponent("#mobile").getValue();let nm=this.selectComponent("#mobile").getNm();this.triggerEvent("changepage",{showUnite:true,saveTempMobile:mobile,saveTempMobileNm:nm},{})}},ready:function(){this.setData({uniteLoginUrl:1,uniteOptions:this.data.options});this.formatOptions(PREFIX);if(!this.data.saveTempMobile&&this.data.preMobile){this.setPreMobile()}else{this.setTempMobile()}this.CHECKFORMLIST=CHECKFORMLIST;this.ERRORMAP=ERRORMAP;this.REGMAP=REGMAP;if(this.data.options.changeColor){this.setData({changeColor:"color:"+this.data.options.changeColor})}let data={pd:this.data.pd,pkid:this.data.pkid,pkht:this.data.pkht,channel:this.data.channel};let id=wx.getStorageSync(this.data.sidkey);if(id){data.id=id}util.setBtnTxt(this.data.loginbtntxt,"mbpwdlogin");util.clearFail5("mbpwdlogin");this.requestProxy({isInit:1,url:"/dl/wx/yd/ini",data:data,success:this.initSuccess.bind(this),fail:this.initFail.bind(this)})}});